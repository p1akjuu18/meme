<!DOCTYPE html>
<html>
<head>
    <title>交易记录</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container { margin-top: 30px; }
        .trade-form { margin-bottom: 30px; }
        .table th, .table td { text-align: center; }
        .profit { color: #00a854; }
        .loss { color: #f04134; }
    </style>
</head>
<body>
    <div class="container">
        <h2>添加交易记录</h2>
        <div class="trade-form">
            <form id="tradeForm">
                <div class="row">
                    <div class="col-md-2">
                        <div class="form-group">
                            <label>交易品种</label>
                            <input type="text" class="form-control" id="symbol" required>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label>开仓价格</label>
                            <input type="number" step="0.0001" class="form-control" id="entryPrice" required>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label>止损价格</label>
                            <input type="number" step="0.0001" class="form-control" id="stopLoss">
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label>止盈价格</label>
                            <input type="number" step="0.0001" class="form-control" id="takeProfit">
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label>平仓价格</label>
                            <input type="number" step="0.0001" class="form-control" id="exitPrice">
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label>数量</label>
                            <input type="number" step="0.0001" class="form-control" id="quantity" required>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>交易日期</label>
                            <input type="date" class="form-control" id="tradeDate" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>状态</label>
                            <select class="form-control" id="status">
                                <option value="开仓">开仓</option>
                                <option value="平仓">平仓</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>跟单人</label>
                            <select class="form-control" id="trader">
                                <option value="">请选择跟单人</option>
                                <option value="科币托">科币托</option>
                                <option value="打不死的交易员">打不死的交易员</option>
                                <option value="波浪理论学习">波浪理论学习</option>
                                <option value="林老师链上分析">林老师链上分析</option>
                                <option value="加密大漂亮">加密大漂亮</option>
                                <option value="提阿非罗">提阿非罗</option>
                                <option value="舒琴">舒琴</option>
                                <option value="三马哥">三马哥</option>
                                <option value="苏禾">苏禾</option>
                                <option value="币圈所长">币圈所长</option>
                                <option value="shu-crypto">shu-crypto</option>
                                <option value="颜驰">颜驰</option>
                                <option value="三木的交易日记">三木的交易日记</option>
                                <option value="比特币军长">比特币军长</option>
                                <option value="大镖客">大镖客</option>
                                <option value="Gauls">Gauls</option>
                                <option value="Titan">Titan</option>
                                <option value="traeep">traeep</option>
                                <option value="eliz">eliz</option>
                                <option value="woods">woods</option>
                                <option value="Vivian">Vivian</option>
                                <option value="Rose">Rose</option>
                                <option value="dr-profit">dr-profit</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>备注</label>
                            <input type="text" class="form-control" id="notes">
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary mt-3">保存</button>
            </form>
        </div>

        <h2>交易记录</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>日期</th>
                    <th>品种</th>
                    <th>开仓价</th>
                    <th>止损</th>
                    <th>止盈</th>
                    <th>平仓价</th>
                    <th>数量</th>
                    <th>状态</th>
                    <th>跟单人</th>
                    <th>盈亏</th>
                    <th>备注</th>
                </tr>
            </thead>
            <tbody id="tradesTable">
            </tbody>
        </table>
    </div>

    <script>
        function loadTrades() {
            fetch('/api/trades')
                .then(response => response.json())
                .then(trades => {
                    const tbody = document.getElementById('tradesTable');
                    tbody.innerHTML = '';
                    trades.forEach(trade => {
                        const row = document.createElement('tr');
                        const profitLossClass = trade.profit_loss > 0 ? 'profit' : 
                                              trade.profit_loss < 0 ? 'loss' : '';
                        row.innerHTML = `
                            <td>${trade.trade_date}</td>
                            <td>${trade.symbol}</td>
                            <td>${trade.entry_price}</td>
                            <td>${trade.stop_loss || '-'}</td>
                            <td>${trade.take_profit || '-'}</td>
                            <td>${trade.exit_price || '-'}</td>
                            <td>${trade.quantity}</td>
                            <td>${trade.status || '-'}</td>
                            <td>${trade.trader || '-'}</td>
                            <td class="${profitLossClass}">${trade.profit_loss || '-'}</td>
                            <td>${trade.notes || ''}</td>
                        `;
                        tbody.appendChild(row);
                    });
                });
        }

        document.getElementById('tradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                symbol: document.getElementById('symbol').value,
                entry_price: parseFloat(document.getElementById('entryPrice').value),
                stop_loss: parseFloat(document.getElementById('stopLoss').value) || null,
                take_profit: parseFloat(document.getElementById('takeProfit').value) || null,
                exit_price: parseFloat(document.getElementById('exitPrice').value) || null,
                quantity: parseFloat(document.getElementById('quantity').value),
                trade_date: document.getElementById('tradeDate').value,
                status: document.getElementById('status').value,
                trader: document.getElementById('trader').value,
                profit_loss: document.getElementById('exitPrice').value ? 
                    (document.getElementById('exitPrice').value - document.getElementById('entryPrice').value) 
                    * document.getElementById('quantity').value : null,
                notes: document.getElementById('notes').value
            };

            fetch('/api/trades', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if(data.status === 'success') {
                    loadTrades();
                    document.getElementById('tradeForm').reset();
                }
            });
        });

        loadTrades();
    </script>
</body>
</html> 